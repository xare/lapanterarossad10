{#
/**
 * @file
 * Default theme implementation for the checkout order summary.
 *
 * The rendered order totals come from commerce-order-total-summary.html.twig.
 * See commerce-order-receipt.html.twig for examples of manual total theming.
 *
 * Available variables:
 * - order_entity: The order entity.
 * - checkout_step: The current checkout step.
 * - totals: An array of order total values with the following keys:
 *   - subtotal: The order subtotal price.
 *   - adjustments: An array of adjustment totals:
 *     - type: The adjustment type.
 *     - label: The adjustment label.
 *     - total: The adjustment total price.
 *     - weight: The adjustment weight, taken from the adjustment type.
 *   - total: The order total price.
 * - rendered_totals: The rendered order totals.
 */
#}
<div{{ attributes.addClass('checkout-order-summary') }}>
  {% block order_items %}
      <ul class="cart-items">
      {% for order_item in order_entity.getItems %}
        <li>
          {# <td>{{ order_item.getQuantity|number_format }}&nbsp;x</td> #}
          <p class="item-quantity">
            {{ order_item.getQuantity|number_format }}
          </p>
          {# {% if order_item.hasPurchasedEntity %}
            <td>{{ order_item.getPurchasedEntity|commerce_entity_render('summary') }}</td>
          {% else %} #}
            {% if order_item.hasPurchasedEntity %}
            
              {% set variation = order_item.getPurchasedEntity %}
              {% set product = variation.getProduct() %} {# This gets the parent product of the variation. #}
                
              {% if product.hasField('field_portada') and not product.get('field_portada').isEmpty %}
                  {% set image_file = product.get('field_portada').entity %}
                  {% if image_file %}
                    {# Now you can get the URI of the image file and use it in your template. #}
                    {% set image_uri = image_file.uri.value %}
                    <figure class="item-cover">
                      <img 
                        src="{{ image_uri|image_style('media_library') }}" 
                        alt="{{ product.label }}" 
                        class="product-thumbnail">
                  </figure>
                {% endif %}
              {% endif %}
            {% endif %}
            <p class="item-title">
              {{- order_item.label -}}
            </p>
          {# {% endif %} #}
          <p class="item-price">
            {{- order_item.getTotalPrice|commerce_price_format -}}
          </p>
        </li>
      {% endfor %}
    </ul>
  {% endblock %}
  {% block totals %}
    {{ rendered_totals }}
  {% endblock %}
</div>